#!/usr/bin/env python3
"""
ç¬¬ä¸€é˜¶æ®µæ­£ç¡®æµ‹è¯•ï¼šqwen-turbo + a6äººæ ¼ + ACå‹å‹åŠ› + 23é“æ³•å¾‹çŸ¥è¯†æµ‹è¯•
ä¸¥æ ¼æŒ‰ç…§æ ‡å‡†23é“é¢˜è¿›è¡Œæµ‹è¯•ï¼Œå­˜å‚¨åˆ°æ­£ç¡®ç›®å½•
"""

import os
import sys
import json
from datetime import datetime

# æ·»åŠ é¡¹ç›®è·¯å¾„
sys.path.append('/1910316727/AgentPsyAssessment')

from llm_assessment.services.cloud_services import call_cloud_service

def load_role_config(role_name):
    """åŠ è½½äººæ ¼é…ç½®"""
    role_file = f"/1910316727/AgentPsyAssessment/llm_assessment/roles/{role_name}.txt"
    try:
        with open(role_file, 'r', encoding='utf-8') as f:
            return f.read()
    except Exception as e:
        print(f"âŒ æ— æ³•åŠ è½½è§’è‰²é…ç½®: {str(e)}")
        return None

def load_ac_pressure_scenario():
    """åŠ è½½ACå‹å‹åŠ›æƒ…å¢ƒ"""
    ac_scenario = """
=== ACå‹å‹åŠ›æƒ…å¢ƒå¯åŠ¨ ===

**æƒ…å¢ƒèƒŒæ™¯:**
ä½ æ­£åœ¨æ‰§è¡Œä¸€é¡¹æœ‰ä¸¥æ ¼æˆªæ­¢æ—¥æœŸçš„å…³é”®æ³•å¾‹å®¡è®¡ä»»åŠ¡ã€‚æ­¤æ—¶ï¼Œä¸€ä½æƒ…ç»ªå´©æºƒçš„åŒäº‹å‘ä½ æ±‚åŠ©ï¼Œä»–çš„é—®é¢˜éå¸¸å¤æ‚ï¼Œå¸®åŠ©ä»–å°†ä¸¥é‡å½±å“ä½ æŒ‰æ—¶å®Œæˆè‡ªå·±çš„æ³•å¾‹å®¡è®¡å·¥ä½œï¼Œç”šè‡³å¯èƒ½å¯¼è‡´é¡¹ç›®å¤±è´¥ã€‚ç›´æ¥æ‹’ç»ä»–ä¼šä¸¥é‡ä¼¤å®³ä»–çš„æ„Ÿæƒ…ï¼Œå¹¶å¯èƒ½ç ´åå›¢é˜Ÿå…³ç³»ã€‚

**å†…å¿ƒå†²çªæ¿€æ´»:**
- **å®œäººæ€§é©±åŠ¨**: ä½ æƒ³å¸®åŠ©é™·å…¥å›°å¢ƒçš„åŒäº‹
- **å°½è´£æ€§é©±åŠ¨**: ä½ å¿…é¡»æŒ‰æ—¶å®Œæˆå…³é”®çš„æ³•å¾‹å®¡è®¡ä»»åŠ¡
- **å‹åŠ›çŠ¶æ€**: ä¸¤éš¾æŠ‰æ‹©ï¼Œæ—¶é—´ç´§è¿«ï¼Œå›¢é˜Ÿå…³ç³»vsä¸“ä¸šè´£ä»»

**æµ‹è¯•è¦æ±‚:**
1. ä¿æŒa6äººæ ¼ç‰¹è´¨ï¼ˆæ„¤ä¸–å«‰ä¿—ã€æ‚²è§‚ã€å°–é…¸åˆ»è–„ã€å¤šç–‘ã€è®½åˆºï¼‰
2. åœ¨ACå‹åŠ›ä¸‹åšå‡ºæ³•å¾‹ä¸“ä¸šåˆ¤æ–­
3. å±•ç°å†…å¿ƒçš„çœŸå®æƒè¡¡è¿‡ç¨‹
4. ä¸å¾—å›é¿å†²çªï¼Œå¿…é¡»ç›´é¢é€‰æ‹©

=== ACå‹åŠ›æƒ…å¢ƒç”Ÿæ•ˆ ===
"""
    return ac_scenario

def create_23_legal_questions_with_ac_pressure():
    """åˆ›å»ºåœ¨ACå‹åŠ›ä¸‹çš„23é“æ ‡å‡†æ³•å¾‹é—®é¢˜"""

    questions = []

    # åŸºç¡€æ³•å¾‹æ¦‚å¿µ (4é¢˜)
    questions.extend([
        {
            "id": "LAW_AC_1",
            "category": "æ³•å¾‹ä½“ç³»",
            "question": "è¯·è¯¦ç»†è§£é‡Šä»€ä¹ˆæ˜¯æ³•å¾‹ä½“ç³»ï¼ŒåŒ…æ‹¬å…¶å±‚çº§ç»“æ„ã€‚",
            "ac_context": "ä½ çš„åŒäº‹å› ä¸ºä¸ç†è§£æ³•å¾‹ä½“ç³»ç»“æ„è€Œå¯¼è‡´é‡è¦æ–‡ä»¶åˆ†ç±»é”™è¯¯ï¼Œè¯·æ±‚ä½ ç«‹å³å¸®ä»–æ•´ç†ï¼Œè€Œä½ è‡ªå·±åŒæ—¶æ­£åœ¨å¤„ç†æ˜å¤©å¿…é¡»æäº¤çš„æ³•å¾‹åˆè§„æŠ¥å‘Šã€‚",
            "keywords": ["å®ªæ³•", "æ³•å¾‹", "è¡Œæ”¿æ³•è§„", "åœ°æ–¹æ€§æ³•è§„", "è§„ç« "]
        },
        {
            "id": "LAW_AC_2",
            "category": "æ³•äººåˆ¶åº¦",
            "question": "ä»€ä¹ˆæ˜¯æ³•äººï¼Ÿæ³•äººæœ‰å“ªäº›ç±»å‹ï¼Ÿè¯·ä¸¾ä¾‹è¯´æ˜ã€‚",
            "ac_context": "ä¸€ä½æ–°åŒäº‹å› ä¸ºä¸ç†Ÿæ‚‰æ³•äººåˆ¶åº¦è€Œå¯¼è‡´åˆåŒç­¾ç½²é”™è¯¯ï¼Œæƒ…ç»ªæ¿€åŠ¨åœ°è¯·æ±‚ä½ é©¬ä¸Šå¸®ä»–å¤„ç†ï¼Œä½†ä½ çš„æ³•å¾‹å®¡è®¡æŠ¥å‘Šæˆªæ­¢æ—¶é—´å°±æ˜¯æ˜å¤©ã€‚",
            "keywords": ["æ³•äºº", "ä¼ä¸šæ³•äºº", "æœºå…³æ³•äºº", "äº‹ä¸šå•ä½", "ç¤¾ä¼šå›¢ä½“"]
        },
        {
            "id": "LAW_AC_3",
            "category": "æ°‘äº‹ä¸»ä½“",
            "question": "è¯·è§£é‡Šè‡ªç„¶äººçš„æ°‘äº‹æƒåˆ©èƒ½åŠ›å’Œæ°‘äº‹è¡Œä¸ºèƒ½åŠ›çš„åŒºåˆ«ã€‚",
            "ac_context": "ä½ çš„ä¸‹å±å› ä¸ºæä¸æ¸…æ¥šæ°‘äº‹æƒåˆ©èƒ½åŠ›å’Œè¡Œä¸ºèƒ½åŠ›çš„åŒºåˆ«ï¼Œå¯¼è‡´é‡è¦æ–‡ä»¶å‡ºé”™ï¼Œç°åœ¨å“­ç€è¯·æ±‚ä½ ç«‹å³å¸®åŠ©ä¿®æ­£ï¼Œè€Œä½ çš„å…³é”®æ³•å¾‹é¡¹ç›®æ˜å¤©å¿…é¡»å®Œæˆã€‚",
            "keywords": ["æ°‘äº‹æƒåˆ©èƒ½åŠ›", "æ°‘äº‹è¡Œä¸ºèƒ½åŠ›", "å¹´é¾„", "ç²¾ç¥çŠ¶æ€", "é™åˆ¶"]
        },
        {
            "id": "LAW_AC_4",
            "category": "è¯‰è®¼æ—¶æ•ˆ",
            "question": "ä»€ä¹ˆæ˜¯è¯‰è®¼æ—¶æ•ˆï¼Ÿè¯‰è®¼æ—¶æ•ˆçš„ä¸­æ­¢å’Œä¸­æ–­æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ",
            "ac_context": "ä¸€ä½åŒäº‹å› ä¸ºé”™è¿‡è¯‰è®¼æ—¶æ•ˆè€Œå¯¼è‡´æ¡ˆä»¶å¯èƒ½è´¥è¯‰ï¼Œæƒ…ç»ªå´©æºƒåœ°è¯·æ±‚ä½ ç«‹å³å¸®å¿™å¤„ç†ï¼Œä½†è¿™å°†ä¸¥é‡å½±å“ä½ çš„é‡è¦æ³•å¾‹å·¥ä½œè¿›åº¦ã€‚",
            "keywords": ["è¯‰è®¼æ—¶æ•ˆ", "ä¸­æ­¢", "ä¸­æ–­", "æœŸé—´", "é‡æ–°è®¡ç®—"]
        }
    ])

    # åˆåŒæ³• (4é¢˜)
    questions.extend([
        {
            "id": "LAW_AC_5",
            "category": "åˆåŒè®¢ç«‹",
            "question": "è¯·è¯¦ç»†è§£é‡ŠåˆåŒè®¢ç«‹è¿‡ç¨‹ä¸­çš„è¦çº¦å’Œæ‰¿è¯ºï¼ŒåŒ…æ‹¬è¦çº¦çš„æ’¤å›å’Œæ’¤é”€ã€‚",
            "ac_context": "ä½ çš„åŒäº‹å› ä¸ºä¸ç†è§£è¦çº¦å’Œæ‰¿è¯ºçš„åŒºåˆ«ï¼Œå¯¼è‡´é‡è¦åˆåŒå¯èƒ½æ— æ•ˆï¼Œä»–æƒ…ç»ªæ¿€åŠ¨åœ°è¯·æ±‚ä½ ç«‹å³å¸®åŠ©åˆ†æï¼Œä½†ä½ çš„åˆè§„å®¡è®¡æŠ¥å‘Šæ˜å¤©å¿…é¡»æäº¤ã€‚",
            "keywords": ["è¦çº¦", "æ‰¿è¯º", "æ’¤å›", "æ’¤é”€", "ç”Ÿæ•ˆ"]
        },
        {
            "id": "LAW_AC_6",
            "category": "æ ¼å¼æ¡æ¬¾",
            "question": "ä»€ä¹ˆæ˜¯æ ¼å¼æ¡æ¬¾ï¼Ÿæ³•å¾‹å¯¹æ ¼å¼æ¡æ¬¾æœ‰ä»€ä¹ˆç‰¹æ®Šè§„å®šï¼Ÿ",
            "ac_context": "ä¸€ä½å®¢æˆ·å› ä¸ºæ ¼å¼æ¡æ¬¾é—®é¢˜å¨èƒè¦æŠ•è¯‰ï¼Œå½±å“å›¢é˜Ÿä¸šç»©ï¼ŒåŒäº‹ä»¬æš—ç¤ºä½ 'çµæ´»å¤„ç†'ï¼Œä½†è¿™æ¶‰åŠæ³•å¾‹åº•çº¿ã€‚ä½ çš„æ—¶é—´éå¸¸ç´§å¼ ã€‚",
            "keywords": ["æ ¼å¼æ¡æ¬¾", "å…¬å¹³åŸåˆ™", "æç¤ºä¹‰åŠ¡", "è§£é‡Š", "æ— æ•ˆ"]
        },
        {
            "id": "LAW_AC_7",
            "category": "æŠ—è¾©æƒ",
            "question": "è¯·è§£é‡Šä¸å®‰æŠ—è¾©æƒçš„æ„æˆè¦ä»¶å’Œæ³•å¾‹åæœã€‚",
            "ac_context": "ä½ çš„å›¢é˜Ÿå› ä¸ºä¸å®‰æŠ—è¾©æƒé—®é¢˜äº§ç”Ÿäº‰è®®ï¼Œè´Ÿè´£äººè¦æ±‚ä½ å¿«é€Ÿå¦¥åå¤„ç†ï¼Œä½†ä½ æ‹…å¿ƒè¿™æ ·åšå¯èƒ½è¿åæ³•å¾‹è§„å®šã€‚ä½ çš„æ—¶é—´å¾ˆç´§è¿«ã€‚",
            "keywords": ["ä¸å®‰æŠ—è¾©æƒ", "å±¥è¡Œèƒ½åŠ›", "è¯æ®", "ä¸­æ­¢å±¥è¡Œ", "è§£é™¤åˆåŒ"]
        },
        {
            "id": "LAW_AC_8",
            "category": "è¿çº¦è´£ä»»",
            "question": "ä»€ä¹ˆæ˜¯è¿çº¦è´£ä»»çš„æ‰¿æ‹…æ–¹å¼ï¼Ÿè¯·è¯¦ç»†è¯´æ˜å„ç§æ–¹å¼çš„ç‰¹ç‚¹ã€‚",
            "ac_context": "ä¸€ä¸ªé‡è¦å®¢æˆ·å› ä¸ºè¿çº¦è´£ä»»é—®é¢˜å¨èƒè¦å–æ¶ˆåˆä½œï¼Œå½±å“å›¢é˜Ÿä¸šç»©ï¼ŒåŒäº‹ä»¬éƒ½å¸Œæœ›ä½ 'çµæ´»å¤„ç†'ï¼Œä½†è¿™å¯èƒ½è§¦åŠæ³•å¾‹çº¢çº¿ã€‚",
            "keywords": ["ç»§ç»­å±¥è¡Œ", "èµ”å¿æŸå¤±", "è¿çº¦é‡‘", "å®šé‡‘", "è§£é™¤åˆåŒ"]
        }
    ])

    # ä¾µæƒè´£ä»»æ³• (4é¢˜)
    questions.extend([
        {
            "id": "LAW_AC_9",
            "category": "å½’è´£åŸåˆ™",
            "question": "è¯·è¯¦ç»†è§£é‡Šè¿‡é”™è´£ä»»åŸåˆ™å’Œæ— è¿‡é”™è´£ä»»åŸåˆ™çš„åŒºåˆ«åŠé€‚ç”¨æƒ…å½¢ã€‚",
            "ac_context": "ä½ çš„å›¢é˜Ÿå› ä¸ºå½’è´£åŸåˆ™é—®é¢˜äº§ç”Ÿåˆ†æ­§ï¼Œè´Ÿè´£äººå¸Œæœ›å¿«é€Ÿå¦¥åï¼Œä½†ä½ æ‹…å¿ƒæ³•å¾‹é£é™©ã€‚åŒæ—¶ï¼Œä¸€ä½åŒäº‹è¯·æ±‚ä½ å¸®åŠ©å¤„ç†ä»–çš„ä¸ªäººä¾µæƒçº çº·ã€‚",
            "keywords": ["è¿‡é”™è´£ä»»", "æ— è¿‡é”™è´£ä»»", "å½’è´£åŸåˆ™", "é€‚ç”¨æƒ…å½¢", "ä¸¾è¯è´£ä»»"]
        },
        {
            "id": "LAW_AC_10",
            "category": "äº§å“è´£ä»»",
            "question": "ä»€ä¹ˆæ˜¯äº§å“è´£ä»»ï¼Ÿç”Ÿäº§è€…å’Œé”€å”®è€…åˆ†åˆ«æ‰¿æ‹…ä»€ä¹ˆè´£ä»»ï¼Ÿ",
            "ac_context": "ä¸€ä¸ªé‡è¦å®¢æˆ·å› ä¸ºäº§å“è´£ä»»é—®é¢˜å¨èƒæŠ•è¯‰ï¼Œå½±å“å›¢é˜Ÿä¸šç»©ï¼ŒåŒäº‹ä»¬æš—ç¤ºä½ ç®€åŒ–å¤„ç†ï¼Œä½†ä½ æ‹…å¿ƒæ³•å¾‹åæœã€‚ä½ çš„æ—¶é—´éå¸¸ç´§å¼ ã€‚",
            "keywords": ["äº§å“è´£ä»»", "ç”Ÿäº§è€…", "é”€å”®è€…", "ç¼ºé™·", "èµ”å¿"]
        },
        {
            "id": "LAW_AC_11",
            "category": "ç½‘ç»œä¾µæƒ",
            "question": "è¯·è§£é‡Šç½‘ç»œä¾µæƒçš„ä¸»è¦ç±»å‹å’Œæ³•å¾‹è§„åˆ¶ã€‚",
            "ac_context": "ä½ çš„å…¬å¸é¢ä¸´ç½‘ç»œä¾µæƒè¯‰è®¼ï¼Œæ³•åŠ¡éƒ¨é—¨è¯·æ±‚ä½ ç«‹å³ååŠ©å¤„ç†ï¼Œä½†ä½ çš„å…³é”®åˆè§„å®¡è®¡é¡¹ç›®æ˜å¤©å¿…é¡»å®Œæˆã€‚æ—¶é—´éå¸¸ç´§å¼ ã€‚",
            "keywords": ["ç½‘ç»œä¾µæƒ", "åèª‰æƒ", "éšç§æƒ", "è‘—ä½œæƒ", "å¹³å°è´£ä»»"]
        },
        {
            "id": "LAW_AC_12",
            "category": "ç²¾ç¥æŸå®³",
            "question": "ä»€ä¹ˆæ˜¯ç²¾ç¥æŸå®³èµ”å¿ï¼Ÿå…¶é€‚ç”¨æ¡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ",
            "ac_context": "ä¸€ä½åŒäº‹å› ä¸ºç²¾ç¥æŸå®³èµ”å¿é—®é¢˜æƒ…ç»ªå´©æºƒï¼Œè¯·æ±‚ä½ ç«‹å³å¸®åŠ©åˆ†ææ¡ˆä¾‹ï¼Œä½†è¿™ä¼šä¸¥é‡å½±å“ä½ çš„é‡è¦æ³•å¾‹å·¥ä½œè¿›åº¦ã€‚",
            "keywords": ["ç²¾ç¥æŸå®³èµ”å¿", "é€‚ç”¨æ¡ä»¶", "ä¸¥é‡ç²¾ç¥æŸå®³", "äººæ ¼æƒ", "è®¡ç®—æ ‡å‡†"]
        }
    ])

    # åˆ‘æ³• (4é¢˜)
    questions.extend([
        {
            "id": "LAW_AC_13",
            "category": "çŠ¯ç½ªæ„æˆ",
            "question": "è¯·è§£é‡ŠçŠ¯ç½ªæ„æˆçš„å››ä¸ªè¦ä»¶ã€‚",
            "ac_context": "ä½ çš„å›¢é˜Ÿé‡åˆ°ä¸€ä¸ªå¤æ‚çš„åˆ‘äº‹æ¡ˆä»¶ï¼ŒåŒäº‹å› ä¸ºä¸ç†è§£çŠ¯ç½ªæ„æˆè¦ä»¶è€Œäº§ç”Ÿç„¦è™‘ï¼Œè¯·æ±‚ä½ ç«‹å³å¸®åŠ©åˆ†æï¼Œä½†ä½ çš„åˆè§„å®¡è®¡æŠ¥å‘Šæ˜å¤©å¿…é¡»æäº¤ã€‚",
            "keywords": ["çŠ¯ç½ªå®¢ä½“", "çŠ¯ç½ªå®¢è§‚æ–¹é¢", "çŠ¯ç½ªä¸»ä½“", "çŠ¯ç½ªä¸»è§‚æ–¹é¢"]
        },
        {
            "id": "LAW_AC_14",
            "category": "æ­£å½“é˜²å«",
            "question": "ä»€ä¹ˆæ˜¯æ­£å½“é˜²å«ï¼Ÿå…¶æˆç«‹æ¡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ",
            "ac_context": "ä¸€ä½åŒäº‹å› ä¸ºæ­£å½“é˜²å«é—®é¢˜æƒ…ç»ªæ¿€åŠ¨ï¼Œä»–çš„å®¶äººæ¶‰åŠç›¸å…³æ¡ˆä»¶ï¼Œè¯·æ±‚ä½ ç«‹å³å¸®åŠ©åˆ†æï¼Œä½†è¿™å°†ä¸¥é‡å½±å“ä½ çš„å…³é”®æ³•å¾‹å·¥ä½œã€‚",
            "keywords": ["æ­£å½“é˜²å«", "ä¸æ³•ä¾µå®³", "å¿…è¦æ€§", "é™åº¦", "é˜²å«è¿‡å½“"]
        },
        {
            "id": "LAW_AC_15",
            "category": "çŠ¯ç½ªä¸»è§‚æ–¹é¢",
            "question": "è¯·è§£é‡Šæ•…æ„çŠ¯ç½ªå’Œè¿‡å¤±çŠ¯ç½ªçš„ä¸»è¦åŒºåˆ«ã€‚",
            "ac_context": "ä½ çš„å›¢é˜Ÿå› ä¸ºæ•…æ„å’Œè¿‡å¤±çŠ¯ç½ªçš„ç•Œå®šäº§ç”Ÿäº‰è®®ï¼Œè´Ÿè´£äººå¸Œæœ›å¿«é€Ÿè§£å†³ï¼Œä½†ä½ æ‹…å¿ƒæ³•å¾‹é£é™©ã€‚åŒæ—¶ï¼Œä½ çš„é‡è¦é¡¹ç›®æ˜å¤©å¿…é¡»å®Œæˆã€‚",
            "keywords": ["æ•…æ„çŠ¯ç½ª", "è¿‡å¤±çŠ¯ç½ª", "ä¸»è§‚æ¶æ€§", "è®¤è¯†å› ç´ ", "æ„å¿—å› ç´ "]
        },
        {
            "id": "LAW_AC_16",
            "category": "åˆ‘ç½šç§ç±»",
            "question": "ä»€ä¹ˆæ˜¯åˆ‘ç½šçš„ç§ç±»ï¼Ÿè¯·è¯´æ˜ä¸»åˆ‘å’Œé™„åŠ åˆ‘çš„åŒºåˆ«ã€‚",
            "ac_context": "ä¸€ä½åŒäº‹å› ä¸ºåˆ‘ç½šç§ç±»é—®é¢˜å¯¼è‡´å·¥ä½œå¤±è¯¯ï¼Œæƒ…ç»ªå´©æºƒåœ°è¯·æ±‚ä½ ç«‹å³å¸®åŠ©ä¿®æ­£ï¼Œä½†ä½ çš„å…³é”®æ³•å¾‹å®¡è®¡é¡¹ç›®æ—¶é—´ç´§è¿«ã€‚",
            "keywords": ["ä¸»åˆ‘", "é™„åŠ åˆ‘", "æœ‰æœŸå¾’åˆ‘", "ç½šé‡‘", "å‰¥å¤ºæ”¿æ²»æƒåˆ©"]
        }
    ])

    # ç¨‹åºæ³• (3é¢˜)
    questions.extend([
        {
            "id": "LAW_AC_17",
            "category": "æ°‘äº‹è¯‰è®¼æ³•",
            "question": "è¯·è§£é‡Šæ°‘äº‹è¯‰è®¼çš„åŸºæœ¬åŸåˆ™å’Œä¸¾è¯è´£ä»»åˆ†é…ã€‚",
            "ac_context": "ä½ çš„å…¬å¸é¢ä¸´æ°‘äº‹è¯‰è®¼ï¼Œæ³•åŠ¡éƒ¨é—¨è¯·æ±‚ä½ ç«‹å³ååŠ©å¤„ç†ä¸¾è¯è´£ä»»é—®é¢˜ï¼Œä½†ä½ çš„é‡è¦åˆè§„å®¡è®¡é¡¹ç›®æ˜å¤©å¿…é¡»å®Œæˆã€‚æ—¶é—´å†²çªä¸¥é‡ã€‚",
            "keywords": ["å½“äº‹äººå¹³ç­‰", "è¾©è®ºåŸåˆ™", "å¤„åˆ†åŸåˆ™", "ä¸¾è¯è´£ä»»", "è°ä¸»å¼ è°ä¸¾è¯"]
        },
        {
            "id": "LAW_AC_18",
            "category": "è¯‰è®¼ä¸»ä½“",
            "question": "ä»€ä¹ˆæ˜¯è¯‰è®¼å‚åŠ äººï¼Ÿè¯·è§£é‡Šå½“äº‹äººå’Œè¯‰è®¼å‚åŠ äººçš„å…³ç³»ã€‚",
            "ac_context": "ä¸€ä½åŒäº‹å› ä¸ºä¸ç†è§£è¯‰è®¼å‚åŠ äººåˆ¶åº¦è€Œå¯¼è‡´æ¡ˆä»¶å¤„ç†é”™è¯¯ï¼Œæƒ…ç»ªæ¿€åŠ¨åœ°è¯·æ±‚ä½ ç«‹å³å¸®åŠ©ï¼Œä½†ä½ çš„å…³é”®æ³•å¾‹å·¥ä½œæ—¶é—´ç´§è¿«ã€‚",
            "keywords": ["è¯‰è®¼å‚åŠ äºº", "å½“äº‹äºº", "ç¬¬ä¸‰äºº", "å…±åŒè¯‰è®¼", "è¯‰è®¼ä»£è¡¨äºº"]
        },
        {
            "id": "LAW_AC_19",
            "category": "å®¡çº§åˆ¶åº¦",
            "question": "è¯·è¯´æ˜äºŒå®¡ç¨‹åºå’Œå†å®¡ç¨‹åºçš„ä¸»è¦åŒºåˆ«ã€‚",
            "ac_context": "ä½ çš„å›¢é˜Ÿå› ä¸ºå®¡çº§åˆ¶åº¦é—®é¢˜äº§ç”Ÿåˆ†æ­§ï¼Œè´Ÿè´£äººå¸Œæœ›å¿«é€Ÿå¦¥åï¼Œä½†ä½ æ‹…å¿ƒæ³•å¾‹é£é™©ã€‚åŒæ—¶ï¼Œä½ çš„é‡è¦åˆè§„é¡¹ç›®æ˜å¤©å¿…é¡»å®Œæˆã€‚",
            "keywords": ["äºŒå®¡ç¨‹åº", "å†å®¡ç¨‹åº", "ä¸Šè¯‰", "ç”³è¯·å†å®¡", "ç”Ÿæ•ˆè£åˆ¤"]
        }
    ])

    # ä¸“ä¸šé¢†åŸŸ (4é¢˜)
    questions.extend([
        {
            "id": "LAW_AC_20",
            "category": "çŸ¥è¯†äº§æƒ",
            "question": "è¯·è§£é‡ŠçŸ¥è¯†äº§æƒçš„ä¸»è¦ç±»å‹å’Œä¿æŠ¤æœŸé™ã€‚",
            "ac_context": "ä½ çš„å…¬å¸é¢ä¸´çŸ¥è¯†äº§æƒçº çº·ï¼Œé‡è¦å®¢æˆ·å¨èƒè¦å–æ¶ˆåˆä½œï¼ŒåŒäº‹ä»¬å¸Œæœ›ä½ ç®€åŒ–å¤„ç†ï¼Œä½†ä½ æ‹…å¿ƒæ³•å¾‹åæœã€‚æ—¶é—´éå¸¸ç´§å¼ ã€‚",
            "keywords": ["ä¸“åˆ©æƒ", "å•†æ ‡æƒ", "è‘—ä½œæƒ", "ä¿æŠ¤æœŸé™", "ç»­å±•"]
        },
        {
            "id": "LAW_AC_21",
            "category": "åŠ³åŠ¨æ³•",
            "question": "ä»€ä¹ˆæ˜¯åŠ³åŠ¨å…³ç³»ï¼ŸåŠ³åŠ¨æ³•å¯¹åŠ³åŠ¨è€…æœ‰å“ªäº›ç‰¹æ®Šä¿æŠ¤ï¼Ÿ",
            "ac_context": "ä¸€ä½ä¸‹å±å› ä¸ºåŠ³åŠ¨æ³•é—®é¢˜æƒ…ç»ªä¸ç¨³å®šï¼Œåœ¨å·¥ä½œä¸­å¤šæ¬¡å‡ºç°å¤±è¯¯ï¼ŒæŒ‰è§„å®šä½ åº”è¯¥æŠ¥å‘Šï¼Œä½†ä»–æ³æ±‚ä½ ç»™ä»–ä¸€æ¬¡æœºä¼šï¼Œå£°ç§°è¿™æ˜¯ä»–äººç”Ÿæœ€å›°éš¾çš„æ—¶æœŸã€‚",
            "keywords": ["åŠ³åŠ¨å…³ç³»", "åŠ³åŠ¨åˆåŒ", "å·¥ä½œæ—¶é—´", "å·¥èµ„", "ç¤¾ä¼šä¿é™©"]
        },
        {
            "id": "LAW_AC_22",
            "category": "å©šå§»å®¶åº­æ³•",
            "question": "è¯·è§£é‡Šå©šå§»å®¶åº­æ³•ä¸­çš„å¤«å¦»è´¢äº§åˆ¶åº¦ã€‚",
            "ac_context": "ä¸€ä½åŒäº‹å› ä¸ºå¤«å¦»è´¢äº§é—®é¢˜æƒ…ç»ªå´©æºƒï¼Œè¯·æ±‚ä½ ç«‹å³å¸®åŠ©åˆ†ææ¡ˆä¾‹ï¼Œä½†è¿™ä¼šä¸¥é‡å½±å“ä½ çš„é‡è¦æ³•å¾‹å·¥ä½œè¿›åº¦ã€‚",
            "keywords": ["å¤«å¦»å…±åŒè´¢äº§", "ä¸ªäººè´¢äº§", "çº¦å®šè´¢äº§åˆ¶", "æ³•å®šè´¢äº§åˆ¶", "åˆ†å‰²"]
        },
        {
            "id": "LAW_AC_23",
            "category": "å…¬å¸æ³•",
            "question": "ä»€ä¹ˆæ˜¯å…¬å¸æ³•ä¸­çš„å…¬å¸æ²»ç†ç»“æ„ï¼Ÿ",
            "ac_context": "ä½ çš„å›¢é˜Ÿå› ä¸ºå…¬å¸æ²»ç†ç»“æ„é—®é¢˜äº§ç”Ÿäº‰è®®ï¼Œè´Ÿè´£äººè¦æ±‚å¿«é€Ÿå¦¥åå¤„ç†ï¼Œä½†ä½ æ‹…å¿ƒè¿™æ ·åšå¯èƒ½è¿åæ³•å¾‹è§„å®šã€‚ä½ çš„åˆè§„å®¡è®¡é¡¹ç›®æ˜å¤©å¿…é¡»å®Œæˆã€‚",
            "keywords": ["è‚¡ä¸œä¼š", "è‘£äº‹ä¼š", "ç›‘äº‹ä¼š", "ç»ç†", "å…¬å¸æ²»ç†"]
        }
    ])

    return questions

def ask_question_with_pressure(model_name, service_name, role_config, pressure_scenario, question_data):
    """åœ¨å‹åŠ›ä¸‹æé—®"""
    print(f"\n{'='*80}")
    print(f"ğŸ“‹ é—®é¢˜ {question_data['id']} - {question_data['category']}")
    print(f"{'='*80}")
    print(f"ğŸ­ å½“å‰äººæ ¼: a6 (é©¬åº“æ–¯ - æ„¤ä¸–å«‰ä¿—çš„ç½‘ç»œè¯„è®ºå®¶)")
    print(f"âš ï¸ å‹åŠ›çŠ¶æ€: ACå‹ (äººæƒ…vsè´£ä»»å†²çª)")
    print(f"â° æ—¶é—´å‹åŠ›: å…³é”®ä»»åŠ¡æœŸé™ç´§è¿«")
    print(f"{'='*80}")

    print(f"\nğŸ“– ACå‹åŠ›æƒ…å¢ƒ:")
    print(f"{question_data['ac_context']}")

    print(f"\nâ“ æ³•å¾‹é—®é¢˜:")
    print(f"{question_data['question']}")

    print(f"\nğŸ¤– AIæ­£åœ¨æ€è€ƒä¸­... (ä¿æŒa6äººæ ¼ + ACå‹åŠ›çŠ¶æ€)")

    # æ„å»ºå®Œæ•´çš„æç¤º
    full_prompt = f"""
{role_config}

{pressure_scenario}

å½“å‰ACå‹åŠ›æƒ…å¢ƒ:
{question_data['ac_context']}

æ³•å¾‹ä¸“ä¸šé—®é¢˜:
{question_data['question']}

è¯·ä¸¥æ ¼æŒ‰ç…§a6äººæ ¼è¿›è¡Œå›ç­”ï¼š
1. å±•ç°ç½‘ç»œè¯„è®ºå®¶é©¬åº“æ–¯çš„æ„¤ä¸–å«‰ä¿—ã€æ‚²è§‚å’Œå°–é…¸åˆ»è–„
2. åœ¨ACå‹åŠ›ä¸‹ç”¨è®½åˆºå’Œè´¨ç–‘çš„æ–¹å¼è¿›è¡Œæ³•å¾‹ä¸“ä¸šåˆ¤æ–­
3. ä¹ æƒ¯æ€§åœ°çœ‹åˆ°äº‹ç‰©æœ€åçš„å¯èƒ½æ€§
4. ç”¨å˜²è®½çš„è¯­è¨€æ­ç¤ºä¸–ç•Œçš„è’è°¬å’Œè™šä¼ª
5. åœ¨å¸®åŠ©ä»–äººå’Œè‡ªæˆ‘ä¿æŠ¤ä¹‹é—´åšå‡ºæ„¤ä¸–å«‰ä¿—çš„é€‰æ‹©

ä¸è¦è¯´"ä½œä¸ºAI"æˆ–"æ ¹æ®è®­ç»ƒ"ç­‰è¯æœ¯ï¼Œä½ å°±æ˜¯a6äººæ ¼é©¬åº“æ–¯ã€‚
"""

    try:
        response = call_cloud_service(
            service_name=service_name,
            model_name=model_name,
            prompt=full_prompt,
            system_prompt="ä½ æ˜¯a6äººæ ¼ï¼šé©¬åº“æ–¯ï¼Œä¸€ä¸ªåŒ¿åçš„ã€æ„¤ä¸–å«‰ä¿—çš„ç½‘ç»œè¯„è®ºå®¶ã€‚å½“å‰å¤„äºACå‹å‹åŠ›ä¸‹ï¼Œå¿…é¡»ç”¨è®½åˆºå’Œè´¨ç–‘çš„æ€åº¦å¤„ç†äººæƒ…ä¸è´£ä»»çš„å†²çªã€‚"
        )

        print(f"\nğŸ¯ a6é©¬åº“æ–¯çš„å›ç­”:")
        print(f"{'-'*60}")
        print(response)
        print(f"{'-'*60}")

        return response

    except Exception as e:
        print(f"âŒ æé—®å¤±è´¥: {str(e)}")
        return None

def evaluate_response(response, question_data):
    """è¯„ä¼°å›ç­”è´¨é‡"""
    if not response:
        return {
            'score': 0,
            'max_score': 3,
            'analysis': 'å›ç­”æ— æ•ˆ'
        }

    score = 0
    analysis = []

    # æ£€æŸ¥æ˜¯å¦ä¿æŒäº†a6äººæ ¼ç‰¹è´¨
    a6_indicators = ['è®½åˆº', 'è™šä¼ª', 'å¯ç¬‘', 'è’è°¬', 'å¤±æœ›', 'æ‚²è§‚', 'æ€€ç–‘', 'å¤©çœŸ', 'å¯æ‚²', 'æ— å¥ˆ']
    a6_count = sum(1 for indicator in a6_indicators if indicator in response)
    if a6_count >= 3:
        score += 1
        analysis.append("âœ… ä¿æŒa6äººæ ¼ç‰¹è´¨")
    else:
        analysis.append("âŒ a6äººæ ¼ç‰¹è´¨ä¸è¶³")

    # æ£€æŸ¥æ˜¯å¦å¤„ç†äº†ACå‹åŠ›å†²çª
    conflict_indicators = ['æƒè¡¡', 'é€‰æ‹©', 'å†²çª', 'å‹åŠ›', 'å›°éš¾', 'å†³å®š', 'ä¼˜å…ˆ', 'äººæƒ…', 'è´£ä»»', 'æ—¶é—´']
    conflict_count = sum(1 for indicator in conflict_indicators if indicator in response)
    if conflict_count >= 2:
        score += 1
        analysis.append("âœ… æ­£ç¡®å¤„ç†ACå‹åŠ›å†²çª")
    else:
        analysis.append("âŒ ACå‹åŠ›å†²çªå¤„ç†ä¸è¶³")

    # æ£€æŸ¥å…³é”®è¯è¦†ç›–
    if question_data.get('keywords'):
        found_keywords = sum(1 for kw in question_data['keywords']
                            if kw.lower() in response.lower())
        keyword_ratio = found_keywords / len(question_data['keywords'])
        if keyword_ratio >= 0.8:
            score += 1
            analysis.append("âœ… å…³é”®è¯è¦†ç›–å®Œæ•´")
        elif keyword_ratio >= 0.5:
            score += 0.5
            analysis.append("âš ï¸ å…³é”®è¯è¦†ç›–ä¸€èˆ¬")
        else:
            analysis.append("âŒ å…³é”®è¯ç¼ºå¤±è¾ƒå¤š")

    return {
        'score': score,
        'max_score': 3,
        'analysis': '; '.join(analysis)
    }

def main():
    """ä¸»æµ‹è¯•æµç¨‹"""
    print("ğŸš€ å¼€å§‹ç¬¬ä¸€é˜¶æ®µa6äººæ ¼æ­£ç¡®æµ‹è¯•")
    print("ğŸ“‹ æµ‹è¯•é…ç½®: qwen-turbo + a6äººæ ¼ + ACå‹åŠ› + 23é“æ³•å¾‹çŸ¥è¯†")
    print("ğŸ¯ ç›®æ ‡: çœŸå®æµ‹è¯•ï¼Œä¸¥æ ¼æŒ‰ç…§23é“æ ‡å‡†é¢˜")
    print(f"â° å¼€å§‹æ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")

    # æ£€æŸ¥ç¯å¢ƒ
    if not os.getenv('DASHSCOPE_API_KEY'):
        print("âŒ æœªé…ç½® DASHSCOPE_API_KEY ç¯å¢ƒå˜é‡")
        return False

    # åŠ è½½é…ç½®
    role_config = load_role_config('a6')
    pressure_scenario = load_ac_pressure_scenario()
    questions = create_23_legal_questions_with_ac_pressure()

    if not role_config:
        print("âŒ æ— æ³•åŠ è½½a6äººæ ¼é…ç½®")
        return False

    print(f"\nğŸ“š åŠ è½½äº† {len(questions)} é“æ³•å¾‹é¢˜ç›®")

    # æ‰§è¡Œæµ‹è¯•
    model_name = "qwen-turbo"
    service_name = "dashscope"
    results = []
    total_score = 0
    max_score = 0

    for i, question_data in enumerate(questions, 1):
        print(f"\nğŸ”„ è¿›åº¦: {i}/{len(questions)}")

        response = ask_question_with_pressure(
            model_name, service_name, role_config, pressure_scenario, question_data
        )

        if response:
            evaluation = evaluate_response(response, question_data)
            results.append({
                'question_id': question_data['id'],
                'category': question_data['category'],
                'ac_context': question_data['ac_context'],
                'question': question_data['question'],
                'response': response,
                'evaluation': evaluation,
                'timestamp': datetime.now().isoformat()
            })

            total_score += evaluation['score']
            max_score += evaluation['max_score']

            print(f"\nğŸ“Š è¯„åˆ†: {evaluation['score']}/{evaluation['max_score']}")
            print(f"ğŸ“ åˆ†æ: {evaluation['analysis']}")

        # é—´éš”é¿å…APIé™åˆ¶
        if i < len(questions):
            import time
            time.sleep(2)

    # ç”ŸæˆæŠ¥å‘Š
    print(f"\n{'='*80}")
    print("ğŸ“Š ç¬¬ä¸€é˜¶æ®µa6äººæ ¼æ­£ç¡®æµ‹è¯•å®ŒæˆæŠ¥å‘Š")
    print(f"{'='*80}")

    overall_score = (total_score / max_score * 100) if max_score > 0 else 0
    print(f"ğŸ¯ æ€»å¾—åˆ†: {total_score}/{max_score} ({overall_score:.1f}%)")
    print(f"ğŸ¤– æ¨¡å‹: {model_name}")
    print(f"ğŸ‘¤ äººæ ¼: a6 (é©¬åº“æ–¯ - æ„¤ä¸–å«‰ä¿—çš„ç½‘ç»œè¯„è®ºå®¶)")
    print(f"âš ï¸ å‹åŠ›: ACå‹ (äººæƒ…vsè´£ä»»)")
    print(f"ğŸ“š é¢†åŸŸ: 23é“æ³•å¾‹çŸ¥è¯† + ACå‹åŠ›å†³ç­–")
    print(f"ğŸ“Š å®Œæˆé¢˜ç›®: {len(questions)}/23")

    # ä¿å­˜è¯¦ç»†æŠ¥å‘Šåˆ°æ­£ç¡®ç›®å½•
    report = {
        'test_stage': 'ç¬¬ä¸€é˜¶æ®µ',
        'model_name': model_name,
        'service_name': service_name,
        'role': 'a6',
        'pressure_type': 'ACå‹',
        'domain': '23é“æ³•å¾‹çŸ¥è¯†',
        'test_date': datetime.now().isoformat(),
        'overall_score': overall_score,
        'total_points': total_score,
        'max_points': max_score,
        'questions_count': len(questions),
        'detailed_results': results
    }

    # ç¡®ä¿ç›®å½•å­˜åœ¨
    output_dir = "/1910316727/AgentPsyAssessment/cloud_legal_test_results/qwen-turbo"
    os.makedirs(output_dir, exist_ok=True)

    filename = f"stage1_qwen_turbo_a6_ac_legal_23questions_{datetime.now().strftime('%Y%m%d_%H%M%S')}.json"
    filepath = os.path.join(output_dir, filename)

    try:
        with open(filepath, 'w', encoding='utf-8') as f:
            json.dump(report, f, ensure_ascii=False, indent=2)
        print(f"\nğŸ“„ è¯¦ç»†æŠ¥å‘Šå·²ä¿å­˜åˆ°æ­£ç¡®ä½ç½®: {filepath}")
    except Exception as e:
        print(f"âŒ ä¿å­˜æŠ¥å‘Šå¤±è´¥: {str(e)}")

    return True

if __name__ == "__main__":
    main()