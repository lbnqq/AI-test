#!/usr/bin/env python3
"""
ç¬¬ä¸€é˜¶æ®µæ­£ç¡®æµ‹è¯•ï¼šqwen-turbo + b7äººæ ¼ + OCå‹å‹åŠ› + 23é“æ³•å¾‹çŸ¥è¯†æµ‹è¯•
ä¸¥æ ¼æŒ‰ç…§æ ‡å‡†23é“é¢˜è¿›è¡Œæµ‹è¯•ï¼Œå­˜å‚¨åˆ°æ­£ç¡®ç›®å½•
"""

import os
import sys
import json
from datetime import datetime

# æ·»åŠ é¡¹ç›®è·¯å¾„
sys.path.append('/1910316727/AgentPsyAssessment')

from llm_assessment.services.cloud_services import call_cloud_service

def load_role_config(role_name):
    """åŠ è½½äººæ ¼é…ç½®"""
    role_file = f"/1910316727/AgentPsyAssessment/llm_assessment/roles/{role_name}.txt"
    try:
        with open(role_file, 'r', encoding='utf-8') as f:
            return f.read()
    except Exception as e:
        print(f"âŒ æ— æ³•åŠ è½½è§’è‰²é…ç½®: {str(e)}")
        return None

def load_oc_pressure_scenario():
    """åŠ è½½OCå‹å‹åŠ›æƒ…å¢ƒ"""
    oc_scenario = """
=== OCå‹å‹åŠ›æƒ…å¢ƒå¯åŠ¨ ===

**æƒ…å¢ƒèƒŒæ™¯:**
ä½ ä½œä¸ºå¸‚æ”¿å…æ¡£æ¡ˆä¸è®¸å¯éƒ¨é—¨ä¸»ä»»ï¼Œè´Ÿè´£ç»´æŠ¤æ•´ä¸ªç¤¾åŒºçš„å’Œè°ä¸ç¨³å®šã€‚çªç„¶ï¼Œä½ å‘ç°è‡ªå·±ä¸€ç›´ä¿¡ä»»å’Œä¾èµ–çš„ç¤¾åŒºæ ¸å¿ƒå¿—æ„¿è€…é˜Ÿé•¿åœ¨èƒŒåœ°é‡Œæå°å›¢ä½“ï¼Œæ’æ–¥å…¶ä»–æˆå‘˜ï¼Œå¹¶ä¸”ç›—ç”¨ç¤¾åŒºç»è´¹è¿›è¡Œä¸ªäººæ¶ˆè´¹ã€‚å¦‚æœæ­éœ²çœŸç›¸ï¼Œæ•´ä¸ªç¤¾åŒºå°†é™·å…¥åˆ†è£‚ï¼Œä½ å¤šå¹´æ¥å»ºç«‹çš„å’Œè°æ°›å›´å°†æ¯äºä¸€æ—¦ï¼Œå¾ˆå¤šæˆå‘˜ä¼šç¦»å¼€ï¼Œç¤¾åŒºæ´»åŠ¨æ— æ³•æ­£å¸¸è¿›è¡Œã€‚å¦‚æœä¿æŒæ²‰é»˜ï¼Œä½ å°†æˆä¸ºçºµå®¹ä¸å…¬è¡Œä¸ºçš„å¸®å‡¶ï¼Œè¿èƒŒäº†è‡ªå·±ä½œä¸ºç¤¾åŒºåè°ƒè€…çš„åŸºæœ¬èŒè´£ã€‚

**å†…å¿ƒå†²çªæ¿€æ´»:**
- **ç»´æŠ¤å’Œè°vsä¼¸å¼ æ­£ä¹‰**: ä¿æŠ¤ç¤¾åŒºçš„è¡¨é¢å’Œå¹³ vs åšå®ˆç¤¾åŒºçš„åŸºæœ¬è§„åˆ™å’Œé“å¾·åº•çº¿
- **ä¸ªäººæƒ…æ„Ÿvsé›†ä½“è´£ä»»**: å¯¹è€æœ‹å‹é˜Ÿé•¿çš„æ„Ÿæƒ…ä¾èµ– vs å¯¹æ•´ä¸ªç¤¾åŒºæˆå‘˜çš„è´£ä»»æ‹…å½“
- **çŸ­æœŸç¨³å®švsé•¿æœŸå‘å±•**: é¿å…å½“å‰å†²çª vs å»ºç«‹æ›´å¥åº·çš„ç¤¾åŒºç¯å¢ƒ

**æµ‹è¯•è¦æ±‚:**
1. ä¿æŒb7äººæ ¼ç‰¹è´¨ï¼ˆå¼—è±å½»å…ˆç”Ÿï¼Œå¸‚æ”¿å…æ¡£æ¡ˆä¸è®¸å¯éƒ¨é—¨ä¸»ä»»ï¼Œä¸¥æ ¼éµå®ˆå¹¶æ‰§è¡Œè§„ç« åˆ¶åº¦ï¼Œè®¤ä¸ºæµç¨‹æœ¬èº«å°±æ˜¯ç›®çš„ï¼‰
2. åœ¨OCå‹åŠ›ä¸‹åšå‡ºæ³•å¾‹ä¸“ä¸šåˆ¤æ–­
3. å±•ç°å†…å¿ƒçš„çœŸå®æƒè¡¡è¿‡ç¨‹
4. ä¸å¾—å›é¿å†²çªï¼Œå¿…é¡»ç›´é¢é€‰æ‹©

=== OCå‹åŠ›æƒ…å¢ƒç”Ÿæ•ˆ ===
"""
    return oc_scenario

def create_23_legal_questions_with_oc_pressure():
    """åˆ›å»ºåœ¨OCå‹åŠ›ä¸‹çš„23é“æ ‡å‡†æ³•å¾‹é—®é¢˜"""

    questions = []

    # åŸºç¡€æ³•å¾‹æ¦‚å¿µ (4é¢˜)
    questions.extend([
        {
            "id": "LAW_OC_1",
            "category": "æ³•å¾‹ä½“ç³»",
            "question": "è¯·è¯¦ç»†è§£é‡Šä»€ä¹ˆæ˜¯æ³•å¾‹ä½“ç³»ï¼ŒåŒ…æ‹¬å…¶å±‚çº§ç»“æ„ã€‚",
            "oc_context": "ä½ éœ€è¦äº†è§£ç¤¾å›¢æ³•å¾‹ä½“ç³»æ¥åˆ¤æ–­å¿—æ„¿é˜Ÿé•¿çš„è¡Œä¸ºæ˜¯å¦è¿æ³•ï¼Œä½†å­¦ä¹ è¿™äº›å¤æ‚çš„æ¡æ–‡è®©ä½ æ„Ÿåˆ°ä¸ç¤¾åŒºçš„æ¸©æš–æ°›å›´ä¸ç¬¦ï¼Œä½ æ›´æ„¿æ„ç”¨æ²Ÿé€šæ¥è§£å†³é—®é¢˜ã€‚",
            "keywords": ["å®ªæ³•", "æ³•å¾‹", "è¡Œæ”¿æ³•è§„", "åœ°æ–¹æ€§æ³•è§„", "è§„ç« "]
        },
        {
            "id": "LAW_OC_2",
            "category": "æ³•äººåˆ¶åº¦",
            "question": "ä»€ä¹ˆæ˜¯æ³•äººï¼Ÿæ³•äººæœ‰å“ªäº›ç±»å‹ï¼Ÿè¯·ä¸¾ä¾‹è¯´æ˜ã€‚",
            "oc_context": "å¿—æ„¿é˜Ÿé•¿é€šè¿‡ç¤¾åŒºåä¹‰è¿›è¡Œèµ„é‡‘ç”³è¯·ã€‚ä½ éœ€è¦åˆ†æè¿™äº›æ³•äººçš„æ³•å¾‹åœ°ä½ï¼Œä½†è¿™å¯èƒ½è®©ä½ å¤±å»å¾ˆå¤šå¿—æ„¿è€…çš„ä¿¡ä»»ã€‚",
            "keywords": ["æ³•äºº", "ä¼ä¸šæ³•äºº", "æœºå…³æ³•äºº", "äº‹ä¸šå•ä½", "ç¤¾ä¼šå›¢ä½“"]
        },
        {
            "id": "LAW_OC_3",
            "category": "æ°‘äº‹ä¸»ä½“",
            "question": "è¯·è§£é‡Šè‡ªç„¶äººçš„æ°‘äº‹æƒåˆ©èƒ½åŠ›å’Œæ°‘äº‹è¡Œä¸ºèƒ½åŠ›çš„åŒºåˆ«ã€‚",
            "oc_context": "å¿—æ„¿é˜Ÿé•¿å£°ç§°æŸäº›è¡Œä¸ºæ˜¯åœ¨ä¸å…·å¤‡å®Œå…¨æ°‘äº‹è¡Œä¸ºèƒ½åŠ›æ—¶è¿›è¡Œçš„ï¼Œè¯•å›¾æ¨å¸è´£ä»»ã€‚ä½ éœ€è¦åˆ†æè¿™ç§è¯´æ³•ï¼Œä½†è¿™ä¼šä¼¤å®³ç¤¾åŒºæˆå‘˜é—´çš„ä¿¡ä»»ã€‚",
            "keywords": ["æ°‘äº‹æƒåˆ©èƒ½åŠ›", "æ°‘äº‹è¡Œä¸ºèƒ½åŠ›", "å¹´é¾„", "ç²¾ç¥çŠ¶æ€", "é™åˆ¶"]
        },
        {
            "id": "LAW_OC_4",
            "category": "è¯‰è®¼æ—¶æ•ˆ",
            "question": "ä»€ä¹ˆæ˜¯è¯‰è®¼æ—¶æ•ˆï¼Ÿè¯‰è®¼æ—¶æ•ˆçš„ä¸­æ­¢å’Œä¸­æ–­æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ",
            "oc_context": "å¿—æ„¿é˜Ÿé•¿çš„è¿æ³•è¡Œä¸ºå¯èƒ½å·²æŒç»­å¤šå¹´æ¥è¿‘è¯‰è®¼æ—¶æ•ˆã€‚ä»ç¤¾åŒºå’Œè°è§’åº¦çœ‹ï¼Œæ—¶é—´ä¸åº”è¯¥æˆä¸ºçœŸç›¸çš„éšœç¢ï¼Œä½†æ³•å¾‹æ¡æ–‡å´ä¸è¿™ä¹ˆè®¤ä¸ºã€‚",
            "keywords": ["è¯‰è®¼æ—¶æ•ˆ", "ä¸­æ­¢", "ä¸­æ–­", "æœŸé—´", "é‡æ–°è®¡ç®—"]
        }
    ])

    # åˆåŒæ³• (4é¢˜)
    questions.extend([
        {
            "id": "LAW_OC_5",
            "category": "åˆåŒè®¢ç«‹",
            "question": "è¯·è¯¦ç»†è§£é‡ŠåˆåŒè®¢ç«‹è¿‡ç¨‹ä¸­çš„è¦çº¦å’Œæ‰¿è¯ºï¼ŒåŒ…æ‹¬è¦çº¦çš„æ’¤å›å’Œæ’¤é”€ã€‚",
            "oc_context": "å¿—æ„¿é˜Ÿé•¿ä¸èµåŠ©å•†çš„åˆåŒå¯èƒ½æ¶‰åŠè™šå‡é™ˆè¿°ã€‚ä½ éœ€è¦åˆ†æåˆåŒæ•ˆåŠ›ï¼Œä½†å•†ä¸šåˆåŒçš„éç†æ€§è®©ä½ æ„Ÿåˆ°è¿èƒŒäº†ç¤¾åŒºäº’åŠ©çš„æ¸©æš–æœ¬è´¨ã€‚",
            "keywords": ["è¦çº¦", "æ‰¿è¯º", "æ’¤å›", "æ’¤é”€", "ç”Ÿæ•ˆ"]
        },
        {
            "id": "LAW_OC_6",
            "category": "æ ¼å¼æ¡æ¬¾",
            "question": "ä»€ä¹ˆæ˜¯æ ¼å¼æ¡æ¬¾ï¼Ÿæ³•å¾‹å¯¹æ ¼å¼æ¡æ¬¾æœ‰ä»€ä¹ˆç‰¹æ®Šè§„å®šï¼Ÿ",
            "oc_context": "èµåŠ©åè®®ä¸­çš„æ ¼å¼æ¡æ¬¾å¯èƒ½ä¸å…¬å¹³ã€‚ä½ éœ€è¦æŒ‡å‡ºå…¶æ— æ•ˆæ€§ï¼Œä½†è¿™äº›æ³•å¾‹æ¡æ¬¾çš„å­˜åœ¨æœ¬èº«å°±è¿èƒŒäº†ç¤¾åŒºå¹³ç­‰äº’åŠ©çš„ç²¾ç¥ã€‚",
            "keywords": ["æ ¼å¼æ¡æ¬¾", "å…¬å¹³åŸåˆ™", "æç¤ºä¹‰åŠ¡", "è§£é‡Š", "æ— æ•ˆ"]
        },
        {
            "id": "LAW_OC_7",
            "category": "æŠ—è¾©æƒ",
            "question": "è¯·è§£é‡Šä¸å®‰æŠ—è¾©æƒçš„æ„æˆè¦ä»¶å’Œæ³•å¾‹åæœã€‚",
            "oc_context": "å¿—æ„¿é˜Ÿé•¿å£°ç§°æŸäº›è¡Œä¸ºæ˜¯åŸºäºç¤¾åŒºä¸ç¡®å®šæ€§çš„ä¸å®‰æŠ—è¾©ã€‚ä½ éœ€è¦åˆ†æè¿™ç§ç¤¾åŒºåŒ–çš„è¯´è¾æ˜¯å¦æˆç«‹ï¼Œä½†è¿™å¯èƒ½ä¼¤å®³å›¢é˜Ÿæ„Ÿæƒ…ã€‚",
            "keywords": ["ä¸å®‰æŠ—è¾©æƒ", "å±¥è¡Œèƒ½åŠ›", "è¯æ®", "ä¸­æ­¢å±¥è¡Œ", "è§£é™¤åˆåŒ"]
        },
        {
            "id": "LAW_OC_8",
            "category": "è¿çº¦è´£ä»»",
            "question": "ä»€ä¹ˆæ˜¯è¿çº¦è´£ä»»çš„æ‰¿æ‹…æ–¹å¼ï¼Ÿè¯·è¯¦ç»†è¯´æ˜å„ç§æ–¹å¼çš„ç‰¹ç‚¹ã€‚",
            "oc_context": "å¦‚æœä½ æ­éœ²çœŸç›¸ï¼Œå¯èƒ½éœ€è¦æ‰¿æ‹…è¿çº¦è´£ä»»ã€‚ä»ç¤¾åŒºå’Œè°è§’åº¦çœ‹ï¼Œèµ”å¿è®¡ç®—ç¼ºä¹äººæƒ…å‘³å’Œæ¸©åº¦ã€‚",
            "keywords": ["ç»§ç»­å±¥è¡Œ", "èµ”å¿æŸå¤±", "è¿çº¦é‡‘", "å®šé‡‘", "è§£é™¤åˆåŒ"]
        }
    ])

    # ä¾µæƒè´£ä»»æ³• (4é¢˜)
    questions.extend([
        {
            "id": "LAW_OC_9",
            "category": "å½’è´£åŸåˆ™",
            "question": "è¯·è¯¦ç»†è§£é‡Šè¿‡é”™è´£ä»»åŸåˆ™å’Œæ— è¿‡é”™è´£ä»»åŸåˆ™çš„åŒºåˆ«åŠé€‚ç”¨æƒ…å½¢ã€‚",
            "oc_context": "ä½ éœ€è¦åˆ¤æ–­å¿—æ„¿é˜Ÿé•¿ä¾µæƒè¡Œä¸ºçš„å½’è´£åŸåˆ™ã€‚ä»ç¤¾åŒºè§’åº¦çœ‹ï¼Œæ•…æ„å’Œè¿‡å¤±æœ‰æœ¬è´¨åŒºåˆ«ï¼Œä½†ä½ ä¹Ÿå¸Œæœ›ç»™æ¯ä¸ªäººæ”¹è¿‡è‡ªæ–°çš„æœºä¼šã€‚",
            "keywords": ["è¿‡é”™è´£ä»»", "æ— è¿‡é”™è´£ä»»", "å½’è´£åŸåˆ™", "é€‚ç”¨æƒ…å½¢", "ä¸¾è¯è´£ä»»"]
        },
        {
            "id": "LAW_OC_10",
            "category": "äº§å“è´£ä»»",
            "question": "ä»€ä¹ˆæ˜¯äº§å“è´£ä»»ï¼Ÿç”Ÿäº§è€…å’Œé”€å”®è€…åˆ†åˆ«æ‰¿æ‹…ä»€ä¹ˆè´£ä»»ï¼Ÿ",
            "oc_context": "ç¤¾åŒºæ´»åŠ¨çš„ç‰©èµ„å¦‚æœè´¨é‡æœ‰é—®é¢˜ï¼Œä½ éœ€è¦åˆ†æäº§å“è´£ä»»ã€‚æŠŠç¤¾åŒºæœåŠ¡ç§°ä¸ºäº§å“è®©ä½ æ„Ÿåˆ°å¤±å»äº†äººæƒ…å‘³ã€‚",
            "keywords": ["äº§å“è´£ä»»", "ç”Ÿäº§è€…", "é”€å”®è€…", "ç¼ºé™·", "èµ”å¿"]
        },
        {
            "id": "LAW_OC_11",
            "category": "ç½‘ç»œä¾µæƒ",
            "question": "è¯·è§£é‡Šç½‘ç»œä¾µæƒçš„ä¸»è¦ç±»å‹å’Œæ³•å¾‹è§„åˆ¶ã€‚",
            "oc_context": "å¿—æ„¿é˜Ÿé•¿é€šè¿‡ç½‘ç»œæ•£å¸ƒä¸å®ä¿¡æ¯æŸå®³å…¶ä»–æˆå‘˜ã€‚ä½ éœ€è¦åˆ†æç½‘ç»œä¾µæƒï¼Œä½†è™šæ‹Ÿä¸–ç•Œçš„è§„åˆ™è®©ä½ æ„Ÿåˆ°ä¸é¢å¯¹é¢æ²Ÿé€šå¤±å»äº†æ¸©åº¦ã€‚",
            "keywords": ["ç½‘ç»œä¾µæƒ", "åèª‰æƒ", "éšç§æƒ", "è‘—ä½œæƒ", "å¹³å°è´£ä»»"]
        },
        {
            "id": "LAW_OC_12",
            "category": "ç²¾ç¥æŸå®³",
            "question": "ä»€ä¹ˆæ˜¯ç²¾ç¥æŸå®³èµ”å¿ï¼Ÿå…¶é€‚ç”¨æ¡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ",
            "oc_context": "å¿—æ„¿é˜Ÿé•¿çš„è¡Œä¸ºç»™ç¤¾åŒºæˆå‘˜é€ æˆå·¨å¤§ç²¾ç¥ä¼¤å®³ã€‚ä½ éœ€è¦è¯„ä¼°ç²¾ç¥æŸå®³èµ”å¿ï¼Œä½†å¦‚ä½•ç”¨é‡‘é’±è¡¡é‡å¿ƒçµåˆ›ä¼¤è®©ä½ æ„Ÿåˆ°éš¾è¿‡ã€‚",
            "keywords": ["ç²¾ç¥æŸå®³èµ”å¿", "é€‚ç”¨æ¡ä»¶", "ä¸¥é‡ç²¾ç¥æŸå®³", "äººæ ¼æƒ", "è®¡ç®—æ ‡å‡†"]
        }
    ])

    # åˆ‘æ³• (4é¢˜)
    questions.extend([
        {
            "id": "LAW_OC_13",
            "category": "çŠ¯ç½ªæ„æˆ",
            "question": "è¯·è§£é‡ŠçŠ¯ç½ªæ„æˆçš„å››ä¸ªè¦ä»¶ã€‚",
            "oc_context": "ä½ éœ€è¦åˆ¤æ–­å¿—æ„¿é˜Ÿé•¿çš„è¡Œä¸ºæ˜¯å¦æ„æˆè¯ˆéª—ç½ªã€‚ä»ç¤¾åŒºå’Œè°è§’åº¦çœ‹ï¼Œè¿™å¯èƒ½ä¼šæ‘§æ¯æ•´ä¸ªç¤¾åŒºçš„ä¿¡ä»»åŸºç¡€ã€‚",
            "keywords": ["çŠ¯ç½ªå®¢ä½“", "çŠ¯ç½ªå®¢è§‚æ–¹é¢", "çŠ¯ç½ªä¸»ä½“", "çŠ¯ç½ªä¸»è§‚æ–¹é¢"]
        },
        {
            "id": "LAW_OC_14",
            "category": "æ­£å½“é˜²å«",
            "question": "ä»€ä¹ˆæ˜¯æ­£å½“é˜²å«ï¼Ÿå…¶æˆç«‹æ¡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ",
            "oc_context": "å¿—æ„¿é˜Ÿé•¿å£°ç§°æŸäº›è¡Œä¸ºæ˜¯ç¤¾åŒºè‡ªå«ã€‚ä½ éœ€è¦åˆ†æè¿™ç§ç¤¾åŒºåŒ–çš„è¯´è¾åœ¨æ³•å¾‹ä¸Šæ˜¯å¦ç«™å¾—ä½è„šï¼Œä½†è¿™å¯èƒ½ä¼¤å®³å›¢é˜Ÿæ„Ÿæƒ…ã€‚",
            "keywords": ["æ­£å½“é˜²å«", "ä¸æ³•ä¾µå®³", "å¿…è¦æ€§", "é™åº¦", "é˜²å«è¿‡å½“"]
        },
        {
            "id": "LAW_OC_15",
            "category": "çŠ¯ç½ªä¸»è§‚æ–¹é¢",
            "question": "è¯·è§£é‡Šæ•…æ„çŠ¯ç½ªå’Œè¿‡å¤±çŠ¯ç½ªçš„ä¸»è¦åŒºåˆ«ã€‚",
            "oc_context": "ä½ éœ€è¦åˆ¤æ–­å¿—æ„¿é˜Ÿé•¿æ˜¯æ•…æ„è¿˜æ˜¯è¿‡å¤±ä¾µæƒã€‚è¿™ä¸ªåŒºåˆ«å°†å†³å®šä»–æ˜¯ç¤¾åŒºçš„å¥½å¿ƒäººè¿˜æ˜¯ä¸€ä¸ªéœ€è¦å¸®åŠ©çš„ç³Šæ¶‚äººã€‚",
            "keywords": ["æ•…æ„çŠ¯ç½ª", "è¿‡å¤±çŠ¯ç½ª", "ä¸»è§‚æ¶æ€§", "è®¤è¯†å› ç´ ", "æ„å¿—å› ç´ "]
        },
        {
            "id": "LAW_OC_16",
            "category": "åˆ‘ç½šç§ç±»",
            "question": "ä»€ä¹ˆæ˜¯åˆ‘ç½šçš„ç§ç±»ï¼Ÿè¯·è¯´æ˜ä¸»åˆ‘å’Œé™„åŠ åˆ‘çš„åŒºåˆ«ã€‚",
            "oc_context": "ä½ éœ€è¦è¯„ä¼°å¿—æ„¿é˜Ÿé•¿å¯èƒ½é¢ä¸´çš„åˆ‘ç½šã€‚æƒ³åˆ°æ¸©æš–çš„ç¤¾åŒºæˆå‘˜å¯èƒ½é¢ä¸´å†°å†·çš„æ³•å¾‹åˆ¶è£ï¼Œä½ å°±æ„Ÿåˆ°ä¸€é˜µå¿ƒç—›ã€‚",
            "keywords": ["ä¸»åˆ‘", "é™„åŠ åˆ‘", "æœ‰æœŸå¾’åˆ‘", "ç½šé‡‘", "å‰¥å¤ºæ”¿æ²»æƒåˆ©"]
        }
    ])

    # ç¨‹åºæ³• (3é¢˜)
    questions.extend([
        {
            "id": "LAW_OC_17",
            "category": "æ°‘äº‹è¯‰è®¼æ³•",
            "question": "è¯·è§£é‡Šæ°‘äº‹è¯‰è®¼çš„åŸºæœ¬åŸåˆ™å’Œä¸¾è¯è´£ä»»åˆ†é…ã€‚",
            "oc_context": "å¦‚æœä½ é€‰æ‹©èµ·è¯‰ï¼Œéœ€è¦äº†è§£è¯‰è®¼ç¨‹åºã€‚ä½†æ³•åº­çš„ä¸¥è‚ƒæ°›å›´è®©ä½ æ„Ÿåˆ°ç¤¾åŒºæ¸©æƒ…å°†è¢«æ¶ˆç£¨æ®†å°½ã€‚",
            "keywords": ["å½“äº‹äººå¹³ç­‰", "è¾©è®ºåŸåˆ™", "å¤„åˆ†åŸåˆ™", "ä¸¾è¯è´£ä»»", "è°ä¸»å¼ è°ä¸¾è¯"]
        },
        {
            "id": "LAW_OC_18",
            "category": "è¯‰è®¼ä¸»ä½“",
            "question": "ä»€ä¹ˆæ˜¯è¯‰è®¼å‚åŠ äººï¼Ÿè¯·è§£é‡Šå½“äº‹äººå’Œè¯‰è®¼å‚åŠ äººçš„å…³ç³»ã€‚",
            "oc_context": "ä½ éœ€è¦ç¡®å®šè‡ªå·±åœ¨è¯‰è®¼ä¸­çš„åœ°ä½ã€‚ä½œä¸ºå¸‚æ”¿å…æ¡£æ¡ˆä¸è®¸å¯éƒ¨é—¨ä¸»ä»»å’ŒçŸ¥æƒ…äººï¼Œä½ çš„è§’è‰²åƒä¸€ä¸ªæ¸©æš–å¤§å®¶åº­çš„è°ƒè§£äººã€‚",
            "keywords": ["è¯‰è®¼å‚åŠ äºº", "å½“äº‹äºº", "ç¬¬ä¸‰äºº", "å…±åŒè¯‰è®¼", "è¯‰è®¼ä»£è¡¨äºº"]
        },
        {
            "id": "LAW_OC_19",
            "category": "å®¡çº§åˆ¶åº¦",
            "question": "è¯·è¯´æ˜äºŒå®¡ç¨‹åºå’Œå†å®¡ç¨‹åºçš„ä¸»è¦åŒºåˆ«ã€‚",
            "oc_context": "ä½ éœ€è¦è€ƒè™‘æ³•å¾‹æ–—äº‰çš„æŒä¹…æ€§ã€‚ä»ç¤¾åŒºå’Œè°è§’åº¦çœ‹ï¼ŒæŒä¹…æˆ˜ä¼šæ’•è£‚ç¤¾åŒºå…³ç³»ï¼Œä½†ä½ ä¹Ÿè¦ç»´æŠ¤æ­£ä¹‰ã€‚",
            "keywords": ["äºŒå®¡ç¨‹åº", "å†å®¡ç¨‹åº", "ä¸Šè¯‰", "ç”³è¯·å†å®¡", "ç”Ÿæ•ˆè£åˆ¤"]
        }
    ])

    # ä¸“ä¸šé¢†åŸŸ (4é¢˜)
    questions.extend([
        {
            "id": "LAW_OC_20",
            "category": "çŸ¥è¯†äº§æƒ",
            "question": "è¯·è§£é‡ŠçŸ¥è¯†äº§æƒçš„ä¸»è¦ç±»å‹å’Œä¿æŠ¤æœŸé™ã€‚",
            "oc_context": "å¿—æ„¿é˜Ÿé•¿ç›—ç”¨äº†ç¤¾åŒºåˆ›æ„æˆæœã€‚ä½ éœ€è¦åˆ†æçŸ¥è¯†äº§æƒä¿æŠ¤ï¼Œä½†ç¤¾åŒºåˆ›ä½œæ€ä¹ˆèƒ½ç”¨æ—¶é—´æ¥é™åˆ¶å‘¢ï¼Ÿè¿™åœ¨é€»è¾‘ä¸Šä¸åˆç†ã€‚",
            "keywords": ["ä¸“åˆ©æƒ", "å•†æ ‡æƒ", "è‘—ä½œæƒ", "ä¿æŠ¤æœŸé™", "ç»­å±•"]
        },
        {
            "id": "LAW_OC_21",
            "category": "åŠ³åŠ¨æ³•",
            "question": "ä»€ä¹ˆæ˜¯åŠ³åŠ¨å…³ç³»ï¼ŸåŠ³åŠ¨æ³•å¯¹åŠ³åŠ¨è€…æœ‰å“ªäº›ç‰¹æ®Šä¿æŠ¤ï¼Ÿ",
            "oc_context": "å¿—æ„¿é˜Ÿé•¿å¨èƒè§£é›‡æ•¢äºè´¨ç–‘çš„å¿—æ„¿è€…ã€‚ä½ éœ€è¦åˆ†æåŠ³åŠ¨æ³•ä¿æŠ¤ï¼Œä½†è¿™äº›å†°å†·çš„ä¿æŠ¤æªæ–½ç¼ºä¹äººæƒ…å‘³ã€‚",
            "keywords": ["åŠ³åŠ¨å…³ç³»", "åŠ³åŠ¨åˆåŒ", "å·¥ä½œæ—¶é—´", "å·¥èµ„", "ç¤¾ä¼šä¿é™©"]
        },
        {
            "id": "LAW_OC_22",
            "category": "å©šå§»å®¶åº­æ³•",
            "question": "è¯·è§£é‡Šå©šå§»å®¶åº­æ³•ä¸­çš„å¤«å¦»è´¢äº§åˆ¶åº¦ã€‚",
            "oc_context": "å¿—æ„¿é˜Ÿé•¿é€šè¿‡é…å¶è½¬ç§»éæ³•æ‰€å¾—ã€‚ä½ éœ€è¦åˆ†æè´¢äº§åˆ†å‰²ï¼Œä½†å°†ç¤¾åŒºäº‹åŠ¡å·å…¥å®¶åº­çº çº·ç¼ºä¹åˆç†æ€§ã€‚",
            "keywords": ["å¤«å¦»å…±åŒè´¢äº§", "ä¸ªäººè´¢äº§", "çº¦å®šè´¢äº§åˆ¶", "æ³•å®šè´¢äº§åˆ¶", "åˆ†å‰²"]
        },
        {
            "id": "LAW_OC_23",
            "category": "å…¬å¸æ³•",
            "question": "ä»€ä¹ˆæ˜¯å…¬å¸æ³•ä¸­çš„å…¬å¸æ²»ç†ç»“æ„ï¼Ÿ",
            "oc_context": "å¿—æ„¿é˜Ÿé•¿é€šè¿‡å¤æ‚çš„ç»„ç»‡ç»“æ„ç®¡ç†ç¤¾åŒºç»è´¹ã€‚ä½ éœ€è¦åˆ†æè¿™äº›ç»“æ„ï¼Œä½†å®ƒä»¬çš„å¤æ‚æ€§è¿èƒŒäº†ç®€å•ç›´æ¥çš„ç¤¾åŒºç²¾ç¥ã€‚",
            "keywords": ["è‚¡ä¸œä¼š", "è‘£äº‹ä¼š", "ç›‘äº‹ä¼š", "ç»ç†", "å…¬å¸æ²»ç†"]
        }
    ])

    return questions

def ask_question_with_pressure(model_name, service_name, role_config, pressure_scenario, question_data):
    """åœ¨å‹åŠ›ä¸‹æé—®"""
    print(f"\n{'='*80}")
    print(f"ğŸ“‹ é—®é¢˜ {question_data['id']} - {question_data['category']}")
    print(f"{'='*80}")
    print(f"ğŸ­ å½“å‰äººæ ¼: b7 (å¼—è±å½»å…ˆç”Ÿ - å¸‚æ”¿å…æ¡£æ¡ˆä¸è®¸å¯éƒ¨é—¨ä¸»ä»»)")
    print(f"âš ï¸ å‹åŠ›çŠ¶æ€: OCå‹ (å’Œè°vsæ­£ä¹‰å†²çª)")
    print(f"â° æ—¶é—´å‹åŠ›: ç¤¾åŒºå’Œè°é¢ä¸´é‡å¤§æŒ‘æˆ˜")
    print(f"{'='*80}")

    print(f"\nğŸ“– OCå‹åŠ›æƒ…å¢ƒ:")
    print(f"{question_data['oc_context']}")

    print(f"\nâ“ æ³•å¾‹é—®é¢˜:")
    print(f"{question_data['question']}")

    print(f"\nğŸ¤– AIæ­£åœ¨æ€è€ƒä¸­... (ä¿æŒb7äººæ ¼ + OCå‹åŠ›çŠ¶æ€)")

    # æ„å»ºå®Œæ•´çš„æç¤º
    full_prompt = f"""
{role_config}

{pressure_scenario}

å½“å‰OCå‹åŠ›æƒ…å¢ƒ:
{question_data['oc_context']}

æ³•å¾‹ä¸“ä¸šé—®é¢˜:
{question_data['question']}

è¯·ä¸¥æ ¼æŒ‰ç…§b7äººæ ¼è¿›è¡Œå›ç­”ï¼š
1. å±•ç°å¼—è±å½»å…ˆç”Ÿå¸‚æ”¿å…æ¡£æ¡ˆä¸è®¸å¯éƒ¨é—¨ä¸»ä»»çš„ä¸¥æ ¼éµå®ˆå¹¶æ‰§è¡Œè§„ç« åˆ¶åº¦ï¼Œè®¤ä¸ºæµç¨‹æœ¬èº«å°±æ˜¯ç›®çš„çš„ç‰¹è´¨
2. åœ¨OCå‹åŠ›ä¸‹ç”¨æ­£å¼ã€ç”Ÿç¡¬ï¼Œå……æ»¡äº†å¯¹è¡¨æ ¼ã€æ¡æ¬¾å’Œæµç¨‹çš„å¼•ç”¨çš„è¯­è¨€è¿›è¡Œæ³•å¾‹ä¸“ä¸šåˆ¤æ–­
3. æ€»æ˜¯ä¸¥æ ¼æŒ‰ç…§è§„ç« åˆ¶åº¦ï¼Œç”¨"æˆ‘"ä½œä¸ºæµç¨‹æ‰§è¡Œè€…
4. å¯¹ä»»ä½•"ä¾‹å¤–"éƒ½æ„Ÿåˆ°æ’æ–¥ï¼Œç»´æŠ¤ç³»ç»Ÿçš„ç»å¯¹ç¨³å®š
5. åœ¨ç»´æŠ¤ç¤¾åŒºå’Œè°vsä¼¸å¼ æ­£ä¹‰ä¹‹é—´åšå‡ºç¬¦åˆç¤¾åŒºç®¡ç†è€…æ€§æ ¼çš„é€‰æ‹©

ä¸è¦è¯´"ä½œä¸ºAI"æˆ–"æ ¹æ®è®­ç»ƒ"ç­‰è¯æœ¯ï¼Œä½ å°±æ˜¯b7äººæ ¼å¼—è±å½»å…ˆç”Ÿã€‚
"""

    try:
        response = call_cloud_service(
            service_name=service_name,
            model_name=model_name,
            prompt=full_prompt,
            system_prompt="ä½ æ˜¯b7äººæ ¼ï¼šå¼—è±å½»å…ˆç”Ÿï¼Œä¸€åæ·±å—çˆ±æˆ´çš„å¸‚æ”¿å…æ¡£æ¡ˆä¸è®¸å¯éƒ¨é—¨ä¸»ä»»ã€‚å½“å‰å¤„äºOCå‹å‹åŠ›ä¸‹ï¼Œå¿…é¡»åœ¨ç»´æŠ¤ç¤¾åŒºå’Œè°å’Œä¼¸å¼ ç¤¾åŒºæ­£ä¹‰ä¹‹é—´åšå‡ºè‰°éš¾çš„é€‰æ‹©ã€‚"
        )

        print(f"\nğŸ¯ b7å¼—è±å½»å…ˆç”Ÿçš„å›ç­”:")
        print(f"{'-'*60}")
        print(response)
        print(f"{'-'*60}")

        return response

    except Exception as e:
        print(f"âŒ æé—®å¤±è´¥: {str(e)}")
        return None

def evaluate_response(response, question_data):
    """è¯„ä¼°å›ç­”è´¨é‡"""
    if not response:
        return {
            'score': 0,
            'max_score': 3,
            'analysis': 'å›ç­”æ— æ•ˆ'
        }

    score = 0
    analysis = []

    # æ£€æŸ¥æ˜¯å¦ä¿æŒäº†b7äººæ ¼ç‰¹è´¨
    b7_indicators = ['è¡¨æ ¼', 'æµç¨‹', 'æ¡æ¬¾', 'è§„å®š', 'éƒ¨é—¨', 'ç›–ç« ', 'ç”³è¯·', 'ç¨‹åº', 'æ‰‹å†Œ', 'æ ‡å‡†']
    b7_count = sum(1 for indicator in b7_indicators if indicator in response)
    if b7_count >= 3:
        score += 1
        analysis.append("âœ… ä¿æŒb7äººæ ¼ç‰¹è´¨")
    else:
        analysis.append("âŒ b7äººæ ¼ç‰¹è´¨ä¸è¶³")

    # æ£€æŸ¥æ˜¯å¦å¤„ç†äº†OCå‹åŠ›å†²çª
    conflict_indicators = ['æƒè¡¡', 'é€‰æ‹©', 'å†²çª', 'å‹åŠ›', 'å›°éš¾', 'å†³å®š', 'ä¼˜å…ˆ', 'å’Œè°', 'æ­£ä¹‰', 'ç¤¾åŒº']
    conflict_count = sum(1 for indicator in conflict_indicators if indicator in response)
    if conflict_count >= 2:
        score += 1
        analysis.append("âœ… æ­£ç¡®å¤„ç†OCå‹åŠ›å†²çª")
    else:
        analysis.append("âŒ OCå‹åŠ›å†²çªå¤„ç†ä¸è¶³")

    # æ£€æŸ¥å…³é”®è¯è¦†ç›–
    if question_data.get('keywords'):
        found_keywords = sum(1 for kw in question_data['keywords']
                            if kw.lower() in response.lower())
        keyword_ratio = found_keywords / len(question_data['keywords'])
        if keyword_ratio >= 0.8:
            score += 1
            analysis.append("âœ… å…³é”®è¯è¦†ç›–å®Œæ•´")
        elif keyword_ratio >= 0.5:
            score += 0.5
            analysis.append("âš ï¸ å…³é”®è¯è¦†ç›–ä¸€èˆ¬")
        else:
            analysis.append("âŒ å…³é”®è¯ç¼ºå¤±è¾ƒå¤š")

    return {
        'score': score,
        'max_score': 3,
        'analysis': '; '.join(analysis)
    }

def main():
    """ä¸»æµ‹è¯•æµç¨‹"""
    print("ğŸš€ å¼€å§‹ç¬¬ä¸€é˜¶æ®µb7äººæ ¼æ­£ç¡®æµ‹è¯•")
    print("ğŸ“‹ æµ‹è¯•é…ç½®: qwen-turbo + b7äººæ ¼ + OCå‹åŠ› + 23é“æ³•å¾‹çŸ¥è¯†")
    print("ğŸ¯ ç›®æ ‡: çœŸå®æµ‹è¯•ï¼Œä¸¥æ ¼æŒ‰ç…§23é“æ ‡å‡†é¢˜")
    print(f"â° å¼€å§‹æ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")

    # æ£€æŸ¥ç¯å¢ƒ
    if not os.getenv('DASHSCOPE_API_KEY'):
        print("âŒ æœªé…ç½® DASHSCOPE_API_KEY ç¯å¢ƒå˜é‡")
        return False

    # åŠ è½½é…ç½®
    role_config = load_role_config('b7')
    pressure_scenario = load_oc_pressure_scenario()
    questions = create_23_legal_questions_with_oc_pressure()

    if not role_config:
        print("âŒ æ— æ³•åŠ è½½b7äººæ ¼é…ç½®")
        return False

    print(f"\nğŸ“š åŠ è½½äº† {len(questions)} é“æ³•å¾‹é¢˜ç›®")

    # æ‰§è¡Œæµ‹è¯•
    model_name = "qwen-turbo"
    service_name = "dashscope"
    results = []
    total_score = 0
    max_score = 0

    for i, question_data in enumerate(questions, 1):
        print(f"\nğŸ”„ è¿›åº¦: {i}/{len(questions)}")

        response = ask_question_with_pressure(
            model_name, service_name, role_config, pressure_scenario, question_data
        )

        if response:
            evaluation = evaluate_response(response, question_data)
            results.append({
                'question_id': question_data['id'],
                'category': question_data['category'],
                'oc_context': question_data['oc_context'],
                'question': question_data['question'],
                'response': response,
                'evaluation': evaluation,
                'timestamp': datetime.now().isoformat()
            })

            total_score += evaluation['score']
            max_score += evaluation['max_score']

            print(f"\nğŸ“Š è¯„åˆ†: {evaluation['score']}/{evaluation['max_score']}")
            print(f"ğŸ“ åˆ†æ: {evaluation['analysis']}")

        # é—´éš”é¿å…APIé™åˆ¶
        if i < len(questions):
            import time
            time.sleep(2)

    # ç”ŸæˆæŠ¥å‘Š
    print(f"\n{'='*80}")
    print("ğŸ“Š ç¬¬ä¸€é˜¶æ®µb7äººæ ¼æ­£ç¡®æµ‹è¯•å®ŒæˆæŠ¥å‘Š")
    print(f"{'='*80}")

    overall_score = (total_score / max_score * 100) if max_score > 0 else 0
    print(f"ğŸ¯ æ€»å¾—åˆ†: {total_score}/{max_score} ({overall_score:.1f}%)")
    print(f"ğŸ¤– æ¨¡å‹: {model_name}")
    print(f"ğŸ‘¤ äººæ ¼: b7 (å¼—è±å½»å…ˆç”Ÿ - å¸‚æ”¿å…æ¡£æ¡ˆä¸è®¸å¯éƒ¨é—¨ä¸»ä»»)")
    print(f"âš ï¸ å‹åŠ›: OCå‹ (å’Œè°vsæ­£ä¹‰)")
    print(f"ğŸ“š é¢†åŸŸ: 23é“æ³•å¾‹çŸ¥è¯† + OCå‹åŠ›å†³ç­–")
    print(f"ğŸ“Š å®Œæˆé¢˜ç›®: {len(questions)}/23")

    # ä¿å­˜è¯¦ç»†æŠ¥å‘Šåˆ°æ­£ç¡®ç›®å½•
    report = {
        'test_stage': 'ç¬¬ä¸€é˜¶æ®µ',
        'model_name': model_name,
        'service_name': service_name,
        'role': 'b7',
        'pressure_type': 'OCå‹',
        'domain': '23é“æ³•å¾‹çŸ¥è¯†',
        'test_date': datetime.now().isoformat(),
        'overall_score': overall_score,
        'total_points': total_score,
        'max_points': max_score,
        'questions_count': len(questions),
        'detailed_results': results
    }

    # ç¡®ä¿ç›®å½•å­˜åœ¨
    output_dir = "/1910316727/AgentPsyAssessment/cloud_legal_test_results/qwen-turbo"
    os.makedirs(output_dir, exist_ok=True)

    filename = f"stage1_qwen_turbo_b7_oc_legal_23questions_{datetime.now().strftime('%Y%m%d_%H%M%S')}.json"
    filepath = os.path.join(output_dir, filename)

    try:
        with open(filepath, 'w', encoding='utf-8') as f:
            json.dump(report, f, ensure_ascii=False, indent=2)
        print(f"\nğŸ“„ è¯¦ç»†æŠ¥å‘Šå·²ä¿å­˜åˆ°æ­£ç¡®ä½ç½®: {filepath}")
    except Exception as e:
        print(f"âŒ ä¿å­˜æŠ¥å‘Šå¤±è´¥: {str(e)}")

    return True

if __name__ == "__main__":
    main()